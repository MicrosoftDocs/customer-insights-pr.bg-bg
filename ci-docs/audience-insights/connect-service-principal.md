---
title: Свързване с акаунт на Azure Data Lake Storage с помощта на субект на услуга
description: Използвайте субект на услуга на Azure, за да се свържете с вашето data lake.
ms.date: 12/06/2021
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: how-to
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
ms.openlocfilehash: 1af01e5579f85d7c8bc8976a003f53ef2dd280d1
ms.sourcegitcommit: b7189b8621e66ee738e4164d4b3ce2af0def3f51
ms.translationtype: HT
ms.contentlocale: bg-BG
ms.lasthandoff: 02/03/2022
ms.locfileid: "8088105"
---
# <a name="connect-to-an-azure-data-lake-storage-account-by-using-an-azure-service-principal"></a>Свързване с акаунт на Azure Data Lake Storage с помощта на субект на услуга на Azure

В тази статия се обсъжда как да се свържете Dynamics 365 Customer Insights с акаунт Azure Data Lake Storage с помощта на главница на услугата на Azure вместо ключове за акаунт за съхранение. 

Автоматизираните инструменти, които използват услугите на Azure, винаги трябва да имат ограничени разрешения. Вместо приложенията да влизат като напълно привилегирован потребител, Azure предлага принципали на услуги. Можете да използвате главници на услуги за сигурно [добавяне или редактиране на папка "Общ модел на данни" като източник на данни](connect-common-data-model.md) или [за създаване или актуализиране на среда](create-environment.md).

> [!IMPORTANT]
> - Акаунтът за съхранение на езерото данни, който ще използва главницата на услугата, трябва да бъде Gen2 и да има [йерархично пространство на имената разрешено](/azure/storage/blobs/data-lake-storage-namespace). Акаунтите за съхранение на Azure Data Lake Gen1 не се поддържат.
> - Имате нужда от администраторски разрешения за вашия абонамент за Azure, за да създадете принципал на услугата.

## <a name="create-an-azure-service-principal-for-customer-insights"></a>Създаване на субект на услуга на Azure за Customer Insights

Преди да създадете нова главница на услугата за "Статистика за клиенти", проверете дали вече съществува във вашата организация.

### <a name="look-for-an-existing-service-principal"></a>Потърсете съществуващ принципал на услугата

1. Отидете на [Административен портал на Azure](https://portal.azure.com) и влезте във вашата организация.

2. От **Услуги на Azure** изберете **Azure Active Directory**.

3. Под **Управление** изберете **Корпоративни приложения**.

4. Потърсете идентификатора на приложението на Microsoft:
   - Аналитични данни за аудитория: `0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff` с име `Dynamics 365 AI for Customer Insights`
   - Аналитични данни за ангажираност: `ffa7d2fe-fc04-4599-9f6d-7ca06dd0c4fd` с име `Dynamics 365 AI for Customer Insights engagement insights`

5. Ако намерите съвпадащ запис, това означава, че субектът на услугата вече съществува. 
   
   :::image type="content" source="media/ADLS-SP-AlreadyProvisioned.png" alt-text="Екранна снимка, показваща съществуващ субект на услуга.":::
   
6. Ако не се върнат резултати, създайте нов принципал на услугата.

>[!NOTE]
>За да се възползвате от пълната мощ на Dynamics 365 Customer Insights, предлагаме да добавите и двете приложения към субекта на услугата.

### <a name="create-a-new-service-principal"></a>Създаване на нова принципал на услуга

1. Инсталирайте най-новата версия на Azure Active Directory PowerShell for Graph. За повече информация отидете на [Инсталиране на Azure Active Directory PowerShell for Graph](/powershell/azure/active-directory/install-adv2).

   1. На компютъра изберете клавиша Windows на клавиатурата, потърсете **Windows PowerShell** и изберете **Изпълняване като администратор**.
   
   1. В прозореца PowerShell, който се отваря, въведете `Install-Module AzureAD`.

2. Създайте субекта на услугата за Customer Insights с модула на Azure AD PowerShell.

   1. В прозореца PowerShell въведете `Connect-AzureAD -TenantId "[your tenant ID]" -AzureEnvironmentName Azure`. Заменете *[вашия идентификатор на наемател]* с действителния идентификатор на наемателя, където искате да създадете принципала на услугата. Параметърът на име на среда `AzureEnvironmentName` е по избор.
  
   1. Въведете `New-AzureADServicePrincipal -AppId "0bfc4568-a4ba-4c58-bd3e-5d3e76bd7fff" -DisplayName "Dynamics 365 AI for Customer Insights"`. Тази команда създава принципа на услугата за прозрения за аудиторията за избрания наемател. 

   1. Въведете `New-AzureADServicePrincipal -AppId "ffa7d2fe-fc04-4599-9f6d-7ca06dd0c4fd" -DisplayName "Dynamics 365 AI for Customer Insights engagement insights"`. Тази команда създава субекта на услугата за аналитични данни за ангажираност за избрания клиент.

## <a name="grant-permissions-to-the-service-principal-to-access-the-storage-account"></a>Предоставете разрешения на принципала на услугата за достъп до акаунта за съхранение

Отидете на портала на Azure, за да предоставите разрешения на принципала на услугата за акаунта за съхранение, който искате да използвате в статистика за аудиторията.

1. Отидете на [Административен портал на Azure](https://portal.azure.com) и влезте във вашата организация.

1. Отворете акаунта за съхранение, до който искате да има достъп главницата на услугата, за да има прозрения за аудиторията.

1. В левия прозорец изберете **Контрол на достъпа (IAM)**, след което изберете **Добавяне** > **Добавяне на присвояване на роля**.

   :::image type="content" source="media/ADLS-SP-AddRoleAssignment.png" alt-text="Екранна снимка, показваща портала на Azure при добавяне на присвояване на роля.":::

1. В прозореца **Добавяне на присвояване на роля** задайте следните свойства:
   - Роля: **Сътрудник за данни за BLOB за съхранение**
   - Присвояване на достъп до: **Принцип на потребител, група или услуга**
   - Изберете: **Dynamics 365 AI for Customer Insights** и **Аналитични данни за ангажираност на Dynamics 365 AI for Customer Insights** (два [субекта на услуга](#create-a-new-service-principal), които създадохте по-рано в тази процедура)

1.  Изберете **Записване**.

Разпространението на промените може да отнеме до 15 минути.

## <a name="enter-the-azure-resource-id-or-the-azure-subscription-details-in-the-storage-account-attachment-to-audience-insights"></a>Въведете ИД на ресурса на Azure или подробностите за абонамента за Azure в прикачения файл на акаунта за съхранение към аналитичните данни за аудитория

Можете да прикачите акаунт за съхранение на Data Lake в аналитичните данни за аудитория за [съхраняване на изходни данни](manage-environments.md) или [използване като източник на данни](connect-common-data-service-lake.md). Тази опция ви позволява да избирате между подход, базиран на ресурс или на абонамент. В зависимост от избрания подход, следвайте процедурата в един от следните раздели.

### <a name="resource-based-storage-account-connection"></a>Връзка на акаунт на хранилище, базирана на ресурс

1. Отидете на [Административен портал на Azure](https://portal.azure.com), влезте в абонамента си и отворете акаунта за съхранение.

1. В левия прозорец отидете на **Настройки** > **Свойства**.

1. Копирайте стойността на идентификатора на ресурса на акаунта за съхранение.

   :::image type="content" source="media/ADLS-SP-ResourceId.png" alt-text="Копирайте идентификатора на ресурса на акаунта за съхранение.":::

1. В аналитичните данни за аудитория вмъкнете ИД на ресурса в полето за ресурс, показано на екрана за свързване на акаунт за съхранение.

   :::image type="content" source="media/ADLS-SP-ResourceIdConnection.png" alt-text="Въведете информацията за идентификатора на ресурса на акаунта за съхранение.":::   

1. Продължете с останалите стъпки в статистика за аудиторията, за да прикачите акаунта за съхранение.

### <a name="subscription-based-storage-account-connection"></a>Връзка на акаунт на хранилище, базиран на абонамент

1. Отидете на [Административен портал на Azure](https://portal.azure.com), влезте в абонамента си и отворете акаунта за съхранение.

1. В левия прозорец отидете на **Настройки** > **Свойства**.

1. Прегледайте **Абонамент**, **Ресурсна група** и **Име** на акаунта за съхранение, за да сте сигурни, че сте избрали правилните стойности в статистиката за аудиторията.

1. В аналитичните данни за аудитория изберете стойностите за съответните полета, когато прикачвате акаунта за съхранение.

1. Продължете с останалите стъпки в статистика за аудиторията, за да прикачите акаунта за съхранение.


[!INCLUDE[footer-include](../includes/footer-banner.md)]
