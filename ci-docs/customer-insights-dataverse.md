---
title: Работа с данни на Customer Insights в Microsoft Dataverse
description: Научете как да свържете клиентските прозрения и Microsoft Dataverse да разберете изходните единици, които се изнасят за Dataverse.
ms.date: 08/25/2022
ms.reviewer: mhart
ms.subservice: audience-insights
ms.topic: conceptual
author: mukeshpo
ms.author: mukeshpo
manager: shellyha
searchScope:
- ci-system-diagnostic
- customerInsights
ms.openlocfilehash: 9433c411a2c7eb0db137c6392578993d47be82a2
ms.sourcegitcommit: 8559ca47a22d1d7cd9be13531c2eaf0c1083942b
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 10/12/2022
ms.locfileid: "9671238"
---
# <a name="work-with-customer-insights-data-in-microsoft-dataverse"></a>Работа с данни на Customer Insights в Microsoft Dataverse

Customer Insights предоставя опция за предоставяне на изходни обекти в [Microsoft Dataverse](/powerapps/maker/data-platform/data-platform-intro). Тази интеграция позволява лесно споделяне на данни и персонализирано развитие чрез подход с нисък код / без код. Изходните [единици](#output-entities) са достъпни като таблици в среда Dataverse. Можете да използвате данните за всяко друго приложение въз основа на Dataverse таблици. Тези таблици позволяват сценарии като автоматизирани работни потоци през Power Automate или изграждане на приложения с Power Apps.

Свързването с вашата Dataverse среда също ви позволява да [поглъщате данни от локален източници на данни, като използвате Power Platform потоци от данни и портали](connect-power-query.md#add-data-from-on-premises-data-sources).

## <a name="prerequisites"></a>Предварителни изисквания

- Клиентските прозрения и Dataverse среди трябва да се хостват в същия регион.
- Глобална администраторска роля, създадена в околната Dataverse среда. Проверете дали тази [Dataverse среда е свързана с](/power-platform/admin/control-user-access#associate-a-security-group-with-a-dataverse-environment) определени групи за сигурност и се уверете, че сте добавени към тези групи за сигурност.
- Няма друга среда за прозрения на клиентите, която вече е свързана с околната среда, Dataverse която искате да свържете. Научете как да [премахнете съществуваща връзка към Dataverse околната среда](#remove-an-existing-connection-to-a-dataverse-environment).
- Среда, свързана с един акаунт за съхранение, Microsoft Dataverse ако конфигурирате средата да [използва вашия Azure Data Lake Storage](own-data-lake-storage.md) акаунт.

## <a name="dataverse-storage-capacity-entitlement"></a>Dataverse Право на капацитет за съхранение

Абонаментът за клиентски прозрения ви дава възможност за допълнителен капацитет за съществуващ [Dataverse капацитет](/power-platform/admin/capacity-storage) за съхранение на вашата организация. Допълнителният капацитет зависи от броя на профилите, които вашият абонамент използва.

**Пример:**

Ако приемем, че получавате 15 GB съхранение на база данни и 20 GB съхранение на файлове на 100 000 клиентски профила. Ако абонаментът ви включва 300 000 клиентски профила, общият ви капацитет за съхранение е 45 GB (3 x 15 GB) съхранение на база данни и 60 GB съхранение на файлове (3 x 20 GB). По същия начин, ако имате абонамент за B-to-B с 30K акаунти, общият ви капацитет за съхранение е 45 GB (3 x 15 GB) съхранение на база данни и 60 GB съхранение на файлове (3 x 20 GB).

Капацитетът на дневника не е постепенен и фиксиран за вашата организация.

За повече информация относно подробните права на капацитет вижте [Ръководство](https://go.microsoft.com/fwlink/?LinkId=866544) за лицензиране на Dynamics 365.

## <a name="connect-a-dataverse-environment-to-customer-insights"></a>Свързване на Dataverse среда с клиентски прозрения

Стъпката **Microsoft Dataverse** ви позволява да свържете Клиентски прозрения с вашата Dataverse среда, като същевременно [създавате среда](create-environment.md) за клиентски прозрения.

:::image type="content" source="media/dataverse-provisioning.png" alt-text="Споделяне на данни с Microsoft Dataverse автоматично активиране за нови среди.":::

1. Осигурете URL адреса на вашата Dataverse среда или оставете празно, за да имате такъв, създаден за вас.

   > [!NOTE]
   > След установяване на връзката между Клиентски прозрения и Dataverse не променяйте името на организацията за Dataverse околната среда. Името на организацията се използва в URL адреса Dataverse и промененото име прекъсва връзката с Customer Insights.

   [Power Platform администраторите могат да контролират кой може да създаде нова Dataverse среда](/power-platform/admin/control-environment-creation). Ако се опитвате да създадете нова среда за клиентски прозрения и не можете, администраторът може да е деактивирал създаването на среди за всички, с изключение на Dataverse администраторите.

1. Ако използвате собствен акаунт за съхранение на Data Lake:
   1. Изберете Разрешаване **на споделянето на** данни с Dataverse.
   1. Въведете идентификатора на **разрешенията**. За да получите идентификатора за разрешение, [активирайте споделянето на данни със Dataverse собствените си Azure Data Lake Storage](#enable-data-sharing-with-dataverse-from-your-own-azure-data-lake-storage-preview).

## <a name="enable-data-sharing-with-dataverse-from-your-own-azure-data-lake-storage-preview"></a>Разрешаване на споделянето на данни със Dataverse собствен Azure Data Lake Storage (предварителен преглед)

В [собствения си акаунт Azure Data Lake Storage проверете дали потребителят, който настройва средата за клиентски прозрения, има най-малко](own-data-lake-storage.md) разрешения за четец **на данни за съхранение на петна в контейнера** в акаунта `customerinsights` за съхранение.

> [!NOTE]
> Споделянето на данни е приложимо само ако използвате собствения Azure Data Lake Storage си акаунт. Тази настройка не е налична, ако средата за клиентски прозрения използва съхранението по подразбиране Dataverse.

### <a name="limitations"></a>Ограничения

- Само едно към едно картографиране между Dataverse организация и Azure Data Lake Storage сметка. След като дадена Dataverse организация е свързана към акаунт за съхранение, тя не може да се свърже с друг акаунт за съхранение. Това ограничение не Dataverse позволява да се населят множество акаунти за съхранение.
- Споделянето на данни няма да работи, ако е необходима настройка на Azure Private Link за достъп до профила ви Azure Data Lake Storage, защото е зад защитна стена. Dataverse В момента не поддържа връзката с частни крайни точки чрез Private Link.

### <a name="set-up-security-groups-on-your-own-azure-data-lake-storage"></a>Създайте сами групи за сигурност Azure Data Lake Storage

1. Създайте две групи за сигурност на абонамента си за Azure - една група за сигурност Reader **и една** **група за сигурност Contributor** и задайте Microsoft Dataverse услугата като собственик и за двете групи за сигурност.

1. Управлявайте списъка за контрол на достъпа (ACL) в контейнера `customerinsights` във вашия акаунт за съхранение чрез тези групи за сигурност.
   1. Добавете Microsoft Dataverse услугата и всички Dataverse базирани бизнес приложения като Dynamics 365 Marketing към групата за сигурност на **Reader** с **разрешения само** за четене.
   1. Добавете *само* приложението Customer Insights към групата за сигурност на **сътрудниците**, за да предоставите както разрешения за четене, така **и за писане** на профили и прозрения.

### <a name="set-up-powershell"></a>Настройване на PowerShell

Настройте PowerShell, за да изпълните PowerShell скриптове.

1. Инсталирайте най-новата версия на [Azure Active Directory PowerShell за графика](/powershell/azure/active-directory/install-adv2).
   1. На компютъра изберете клавиша Windows на клавиатурата, потърсете **Windows PowerShell** и изберете **Изпълняване като администратор**.
   1. В прозореца PowerShell, който се отваря, въведете `Install-Module AzureAD`.

1. Импортиране на три модула.
   1. В прозореца на PowerShell въведете `Install-Module -Name Az.Accounts` и следвайте стъпките.
   1. Повторете за `Install-Module -Name Az.Resources` и `Install-Module -Name Az.Storage`.

### <a name="execute-powershell-scripts-and-obtain-the-permission-identifier"></a>Изпълнение на скриптове на PowerShell и получаване на идентификатор на разрешение

1. Изтеглете двата скрипта на PowerShell, които трябва да стартирате от GitHub repo [на нашия инженер](https://github.com/trin-msft/byol).
   - `CreateSecurityGroups.ps1`: Изисква администраторски разрешения на наемателя.
   - `ByolSetup.ps1`: Изисква разрешения на собственика на данни за съхранение на Blob на ниво акаунт / контейнер. Този скрипт ще създаде разрешение за вас. Вашата задача за роля може да бъде премахната ръчно след успешно изпълнение на скрипта.

1. Изпълнете `CreateSecurityGroups.ps1` в Windows PowerShell, като предоставите идентификационния номер на абонамента за Azure, съдържащ вашия Azure Data Lake Storage. Отворете скрипта PowerShell в редактор, за да прегледате допълнителна информация и внедрената логика.

   Този скрипт създава две групи за сигурност на вашия абонамент за Azure: една за групата Reader и друга за групата Contributor. Microsoft Dataverse Услугата е собственик и на двете групи за сигурност.

1. Запишете и двете стойности за ID на групата за сигурност, генерирани от този скрипт, за да използвате в скрипта `ByolSetup.ps1`.

   > [!NOTE]
   > Създаването на група за сигурност може да бъде деактивирано на вашия наемател. В този случай ще е необходима ръчна настройка и вашият Azure AD администратор ще трябва да даде възможност за създаване на група за [сигурност](/azure/active-directory/enterprise-users/groups-self-service-management).

1. Изпълнете `ByolSetup.ps1` в Windows PowerShell, като предоставите идентификационния номер на абонамента за Azure, съдържащ вашето Azure Data Lake Storage име на акаунт за съхранение, име на ресурсна група и ID стойностите на групата за защита на читатели и сътрудници. Отворете скрипта PowerShell в редактор, за да прегледате допълнителна информация и внедрената логика.

   Този скрипт добавя необходимия ролеви контрол на достъпа за Microsoft Dataverse услугата и всички Dataverse базирани бизнес приложения. Той също така актуализира списъка за контрол на достъпа (ACL) в контейнера `customerinsights` за групите за сигурност, създадени със скрипта `CreateSecurityGroups.ps1`. Групата сътрудници получава разрешение за rwx, а групата читатели получава *разрешение* само за r-x *.*

1. Копирайте изходния низ, който изглежда като: `https://DVBYODLDemo/customerinsights?rg=285f5727-a2ae-4afd-9549-64343a0gbabc&cg=720d2dae-4ac8-59f8-9e96-2fa675dbdabc`

1. Въведете копирания изходен низ в **полето за идентификатор** на разрешения на стъпката за конфигуриране на околната среда за Microsoft Dataverse.

   :::image type="content" source="media/dataverse-enable-datasharing-BYODL.png" alt-text="Опции за конфигуриране, за да разрешите споделянето на данни от вашето Azure Data Lake Storage с Microsoft Dataverse.":::

## <a name="remove-an-existing-connection-to-a-dataverse-environment"></a>Премахване на съществуваща връзка към околната Dataverse среда

Когато се свързвате Dataverse с среда, съобщението **за грешка Тази организация на CDS вече е прикрепена към друг екземпляр** на Customer Insights означава, че околната среда вече се използва в среда на Dataverse Customer Insights. Можете да премахнете съществуващата връзка като глобален администратор на Dataverse околната среда. Може да отнеме няколко часа, за да се населят промените.

1. Отидете на [Power Apps](https://make.powerapps.com).
1. Изберете околната среда от околната среда берач.
1. Отидете на **решения**.
1. Деинсталирайте или изтрийте решението, наречено **Dynamics 365 Customer Insights Добавка за клиентска карта (Preview).**

ИЛИ

1. Отворете средата си Dataverse.
1. Отидете на решения за **разширени** > **настройки**.
1. Деинсталиране на решението **CustomerInsightsCustomerCard**.

Ако премахването на връзката не успее поради зависимости, трябва да премахнете и зависимостите. За повече информация вижте [Премахване на зависимостите](/power-platform/alm/removing-dependencies).

## <a name="output-entities"></a>Изходни обекти

Някои изходни единици от Customer Insights са налични като таблици в Dataverse. Разделите по-долу описват очакваната схема на тези таблици.

- [CustomerProfile](#customerprofile)
- [КонтактПрофил](#contactprofile)
- [AlternateKey](#alternatekey)
- [UnifiedActivity](#unifiedactivity)
- [CustomerMeasure](#customermeasure)
- [Обогатяване](#enrichment)
- [Прогноза](#prediction)
- [Членство в сегмента](#segment-membership)

### <a name="customerprofile"></a>CustomerProfile

Тази таблица съдържа единния потребителски профил от Customer Insights. Схемата за единен клиентски профил зависи от субектите и атрибутите, използвани в процеса на обединяване на данните. Схемата на потребителския профил обикновено съдържа подмножество на атрибутите от [Дефиниция на Common Data Model на CustomerProfile](/common-data-model/schema/core/applicationcommon/foundationcommon/crmcommon/solutions/customerinsights/customerprofile). За сценария B-to-B клиентският профил съдържа унифицирани акаунти, а схемата обикновено съдържа подмножество от атрибутите от определението на Общия модел на [данни за сметка](/common-data-model/schema/core/applicationcommon/foundationcommon/crmcommon/account).

### <a name="contactprofile"></a>КонтактПрофил

Контактният профил съдържа единна информация за контакт. Контактите са лица, които са [картографирани в акаунт](data-unification-contacts.md) в сценарий B-to-B.

| Column                       | Тип                | Описание     |
| ---------------------------- | ------------------- | --------------- |
|  Раждане            | ДатаЧас       |  Дата на раждане на контакта               |
|  Град                 | Текстово съобщение |  Град на адреса за контакт               |
|  Карта сайта            | Текстово съобщение |  Идентификационен номер на контактния профил               |
|  КонтактПрофилИд     | Еднозначен идентификатор   |  GUID за контакт               |
|  СтранаОрРегион      | Текстово съобщение |  Държава/регион на адреса за контакт               |
|  CustomerId           | Текстово съобщение |  ID на акаунта, контактът е картографиран на               |
|  EntityName           | Текстово съобщение |  Субект, от който идват данните                |
|  FirstName            | Текстово съобщение |  собствено име на контакта               |
|  Пол               | Текстово съобщение |  Пол на контакта               |
|  ИД                   | Текстово съобщение |  Детерминистичен GUID въз основа на`Identifier`               |
|  Идентификатор           | Текстово съобщение |  Вътрешен идентификационен номер на контактния профил: `ContactProfile|CustomerId|ContactId`               |
|  JobTitle             | Текстово съобщение |  Длъжност на контакта               |
|  LastName             | Текстово съобщение |  фамилно име на контакта               |
|  PostalCode           | Текстово съобщение |  Пощенски код на адреса за контакт               |
|  Първичен имейл         | Текстово съобщение |  Имейл адрес на контакта               |
|  Първичен телефон         | Текстово съобщение |  Телефонен номер на контакта               |
|  StateOrProvince      | Текстово съобщение |  Държава или провинция на адреса за контакт               |
|  УлицаАдрес        | Текстово съобщение |  Улица на адреса за контакт               |

### <a name="alternatekey"></a>AlternateKey

Таблицата AlternateKey съдържа ключове на обектите, участвали в процеса на обединяване.

|Column  |Тип  |Описание  |
|---------|---------|---------|
|DataSourceName    |Текстово съобщение         | Име на източник на данни. Например: `datasource5`        |
|EntityName        | Текстово съобщение        | Име на предприятието в Клиентски прозрения. Например: `contact1`        |
|AlternateValue    |Текстово съобщение         |Алтернативен идентификатор, който се съпоставя с идентификатора на клиента. Пример: `cntid_1078`         |
|KeyRing           | Текстово съобщение        | Стойност на JSON  </br> Пример: [{"dataSourceName":" datasource5 ",</br>"entityName":" contact1",</br>"preferredKey":" cntid_1078",</br>"keys":[" cntid_1078"]}]       |
|CustomerId         | Текстово съобщение        | Идентификационен номер на унифицирания потребителски профил.         |
|AlternateKeyId     | Еднозначен идентификатор        |  Алтернативен ключ детерминистичен GUID въз основа на`Identifier`      |
|Идентификатор |   Текстово съобщение      |   `DataSourceName|EntityName|AlternateValue`  </br> Пример: `testdatasource|contact1|cntid_1078`    |

### <a name="unifiedactivity"></a>UnifiedActivity

Тази таблица съдържа дейности от потребители, които са налични в Customer Insights.

| Column            | Тип        | Описание                                                                              |
|-------------------|-------------|------------------------------------------------------------------------------------------|
| CustomerId        | Текстово съобщение      | ИД на профил на клиент                                                                      |
| ActivityId        | Текстово съобщение      | Вътрешен идентификатор на активността на клиента (първичен ключ)                                       |
| SourceEntityName  | Текстово съобщение      | Име на обекта-източник                                                                |
| SourceActivityId  | Текстово съобщение      | Първичен ключ от изходния обект                                                       |
| ActivityType      | Текстово съобщение      | Тип семантична дейност или име на персонализирана дейност                                        |
| ActivityTimeStamp | ДатаЧас    | Печат на времето за активност                                                                      |
| Обръщение             | Текстово съобщение      | Заглавие или име на дейността                                                               |
| Описание       | Текстово съобщение      | Описание на дейността                                                                     |
| URL адрес               | Текстово съобщение      | Връзка към външен URL адрес, специфичен за дейността                                         |
| SemanticData      | Текстово съобщение | Включва списък на двойки ключови стойности за семантични полета за картографиране, специфични за вида дейност |
| RangeIndex        | Текстово съобщение      | Отпечатъкът на Unix, използван за сортиране на времевата линия на дейността и ефективни заявки за диапазон |
| Унифицирана активностId   | Еднозначен идентификатор | Вътрешен идентификатор на активността на клиента (ActivityId) |

### <a name="customermeasure"></a>CustomerMeasure

Тази таблица съдържа изходни данни за базирани на атрибути на клиента мерки.

| Column             | Тип             | Описание                 |
|--------------------|------------------|-----------------------------|
| CustomerId         | Текстово съобщение           | ИД на профил на клиент        |
| Мерки           | Текстово съобщение      | Включва списък с двойки ключови стойности за име на мярка и стойности за дадения клиент |
| Идентификатор | Текстово съобщение           | `Customer_Measure|CustomerId` |
| КлиентМяркаИд | Еднозначен идентификатор     | ИД на профил на клиент |

### <a name="enrichment"></a>Допълване

Тази таблица съдържа резултатите от процеса на обогатяване.

| Column               | Тип             |  Описание                                          |
|----------------------|------------------|------------------------------------------------------|
| CustomerId           | Текстово съобщение           | ИД на профил на клиент                                 |
| EnrichmentProvider   | Текстово съобщение           | Имена доставчика за допълването                                  |
| EnrichmentType       | Текстово съобщение           | Тип на обогатяване                                      |
| Стойности               | Текстово съобщение      | Списък на атрибутите, получени в процеса на обогатяване |
| ОбогатяванеId | Еднозначен идентификатор            | Детерминистичен GUID, генериран от`Identifier` |
| Идентификатор   | Текстово съобщение           | `EnrichmentProvider|EnrichmentType|CustomerId`         |

### <a name="prediction"></a>Прогноза

Тази таблица съдържа резултатите на предсказанията на модела.

| Column               | Тип        | Описание                                          |
|----------------------|-------------|------------------------------------------------------|
| CustomerId           | Текстово съобщение      | ИД на профил на клиент                                  |
| ModelProvider        | Текстово съобщение      | Имена доставчика на модела                                      |
| Модел                | Текстово съобщение      | Име на модела                                                |
| Стойности               | Текстово съобщение | Списък на атрибутите, получени от модела |
| ПредсказаниеId | Еднозначен идентификатор       | Детерминистичен GUID, генериран от`Identifier` |
| Идентификатор   | Текстово съобщение      |  `Model|ModelProvider|CustomerId`                      |

### <a name="segment-membership"></a>Членство в сегмента

Тази таблица съдържа сегментна информация за членството на клиентските профили.

| Column        | Тип | Описание                        |
|--------------------|--------------|-----------------------------|
| CustomerId        | Текстово съобщение       | ИД на профил на клиент        |
| Доставчик на сегменти      | Текстово съобщение       | Приложение, което публикува сегментите.      |
| СегментЧленствоТип | Текстово съобщение       | Тип на клиента за този сегмент членски запис. Поддържа множество типове като клиент, контакт или акаунт. По подразбиране: Клиент  |
| Сегменти       | Текстово съобщение  | Списък на уникалните сегменти, в които клиентският профил е член на      |
| Идентификатор  | Текстово съобщение   | Уникален идентификатор на записа за членство в сегмента. `CustomerId|SegmentProvider|SegmentMembershipType|Name`  |
| СегментЧленствоId | Еднозначен идентификатор      | Детерминистичен GUID, генериран от`Identifier`          |

[!INCLUDE [footer-include](includes/footer-banner.md)]
