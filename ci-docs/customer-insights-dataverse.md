---
title: Работа с данни на Customer Insights в Microsoft Dataverse
description: Научете как да свържете "Аналитични данни за клиенти" и Microsoft Dataverse да разберете изходните обекти, които се експортират в Dataverse.
ms.date: 08/25/2022
ms.reviewer: mhart
ms.subservice: audience-insights
ms.topic: conceptual
author: mukeshpo
ms.author: mukeshpo
manager: shellyha
searchScope:
- ci-system-diagnostic
- customerInsights
ms.openlocfilehash: dfa63110fc5291f2b63aebf588d6fdd20ed4ab67
ms.sourcegitcommit: 134aac66e3e0b77b2e96a595d6acbb91bf9afda2
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 09/07/2022
ms.locfileid: "9424296"
---
# <a name="work-with-customer-insights-data-in-microsoft-dataverse"></a>Работа с данни на Customer Insights в Microsoft Dataverse

Customer Insights предоставя опция за предоставяне на изходни обекти в [Microsoft Dataverse](/powerapps/maker/data-platform/data-platform-intro). Тази интеграция дава възможност за лесно споделяне на данни и персонализирано развитие чрез подход с нисък код/без код. Изходните [обекти](#output-entities) са налични като таблици в Dataverse среда. Можете да използвате данните за всяко друго приложение въз основа на Dataverse таблици. Тези таблици дават възможност за сценарии като автоматизирани работни потоци през Power Automate или изграждане на приложения с Power Apps.

Свързването с вашата Dataverse среда също ви дава възможност да [поглъщате данни от локален източници на данни с помощта на Power Platform потоци от данни и шлюзове](connect-power-query.md#add-data-from-on-premises-data-sources).

## <a name="prerequisites"></a>Предварителни изисквания

- Клиентските аналитични данни и Dataverse среди трябва да се хостват в един и същ регион.
- Глобална роля на администратор, настроена в околната Dataverse среда. Проверете дали тази [Dataverse среда е свързана с](/power-platform/admin/control-user-access#associate-a-security-group-with-a-dataverse-environment) определени групи за защита и се уверете, че сте добавени към тези групи за защита.
- Никоя друга среда на Customer Insights, която вече е свързана със Dataverse средата, която искате да свържете. Научете как да [премахнете съществуваща връзка към Dataverse среда](#remove-an-existing-connection-to-a-dataverse-environment).
- Microsoft Dataverse Среда, свързана към един акаунт за съхранение, ако конфигурирате средата да [използва вашия Azure Data Lake Storage](own-data-lake-storage.md).

## <a name="dataverse-storage-capacity-entitlement"></a>Dataverse право на капацитет за съхранение

Абонамент за Customer Insights ви дава право на допълнителен капацитет за съществуващия [Dataverse капацитет](/power-platform/admin/capacity-storage) за съхранение на вашата организация. Добавеният капацитет зависи от броя на профилите, които абонаментът Ви използва.

**Пример:**

Ако приемем, че получавате 15 GB място за съхранение на база данни и 20 GB място за съхранение на файлове на 100 000 клиентски профила. Ако абонаментът ви включва 300 000 клиентски профила, общият ви капацитет за съхранение е 45 GB (3 x 15 GB) място за съхранение на база данни и място за съхранение на файлове 60 GB (3 x 20 GB). По същия начин, ако имате b-to-B абонамент с 30K акаунти, общият ви капацитет за съхранение е 45 GB (3 x 15 GB) място за съхранение на база данни и 60 GB място за съхранение на файлове (3 x 20 GB).

Капацитетът на регистрационния файл не е постъпково и фиксиран за вашата организация.

За повече информация относно подробните права на капацитет вижте [Ръководство](https://go.microsoft.com/fwlink/?LinkId=866544) за лицензиране на Dynamics 365.

## <a name="connect-a-dataverse-environment-to-customer-insights"></a>Свързване на Dataverse среда към "Аналитични данни за клиенти"

Стъпката **Microsoft Dataverse** ви позволява да свържете Customer Insights с вашата Dataverse среда, докато [създавате среда](create-environment.md) на Customer Insights.

:::image type="content" source="media/dataverse-provisioning.png" alt-text="споделяне на данни с Microsoft Dataverse автоматично активирани за нови среди.":::

1. Предоставете URL адреса на средата си Dataverse или оставете празен, за да имате създаден за вас такъв.

   > [!NOTE]
   > След установяване на връзката между Customer Insights и Dataverse, не променяйте името на организацията за Dataverse средата. Името на организацията се използва в Dataverse URL адреса и променено име прекъсва връзката с Customer Insights.

   [Power Platform администраторите могат да контролират кой може да създаде нови Dataverse среди](/power-platform/admin/control-environment-creation). Ако се опитвате да настроите нова среда на Customer Insights и не можете, администраторът може да е забранил създаването на Dataverse среди за всички, с изключение на администраторите.

1. Ако използвате собствен акаунт за съхранение на data lake:
   1. Изберете **Разрешаване на споделянето на** данни с Dataverse.
   1. Въведете идентификатора **"Разрешения"**. За да получите идентификатора на разрешението, [разрешете споделянето на данни с Dataverse от вашите собствени Azure Data Lake Storage](#enable-data-sharing-with-dataverse-from-your-own-azure-data-lake-storage-preview).

## <a name="enable-data-sharing-with-dataverse-from-your-own-azure-data-lake-storage-preview"></a>Разрешаване на споделянето на данни с Dataverse от вашите собствени Azure Data Lake Storage (визуализация)

В [собствения си профил Azure Data Lake Storage проверете потребителя настройка на средата на Customer Insights има поне](own-data-lake-storage.md) Съхранение Blob Данни Reader **разрешения на** контейнера в `customerinsights` акаунта за съхранение.

### <a name="limitations"></a>Ограничения

- Само съпоставяне "едно към едно" между Dataverse организация и Azure Data Lake Storage акаунт. След като Dataverse дадена организация е свързана към акаунт за съхранение, тя не може да се свърже с друг акаунт за съхранение. Това ограничение предотвратява Dataverse попълването на няколко акаунта за съхранение.
- Споделянето на данни няма да работи, ако е необходима настройка на Azure private Link за достъп до профила Ви Azure Data Lake Storage, защото е зад защитна стена. Dataverse в момента не поддържа връзката с частни крайни точки чрез Private Link.

### <a name="set-up-security-groups-on-your-own-azure-data-lake-storage"></a>Настройване на групи за защита сами Azure Data Lake Storage

1. Създайте две групи за защита на вашия абонамент за Azure - една **група за защита на Reader** и една **група за защита на contributor** и задайте Microsoft Dataverse услугата като собственик и за двете групи за защита.

1. Управление на списъка за контрол на достъпа (ACL) на контейнера `customerinsights` във вашия акаунт за съхранение чрез тези групи за защита.
   1. Добавете Microsoft Dataverse услугата и всякакви Dataverse базирани бизнес приложения като Dynamics 365 Marketing към групата за защита на **Reader** с **разрешения само** за четене.
   1. Добавете *само* приложението "Аналитични данни за клиенти" към групата за защита на **"Сътрудник** ", за да предоставите както разрешения за четене, така **и за запис**, за да пишете профили и аналитични данни.

### <a name="set-up-powershell"></a>Настройване на PowerShell

Настройване на PowerShell за изпълнение на powerShell скриптове.

1. Инсталирайте най-новата версия на [Azure Active Directory PowerShell за графика](/powershell/azure/active-directory/install-adv2).
   1. На компютъра изберете клавиша Windows на клавиатурата, потърсете **Windows PowerShell** и изберете **Изпълняване като администратор**.
   1. В прозореца PowerShell, който се отваря, въведете `Install-Module AzureAD`.

1. Импортиране на три модула.
   1. В прозореца PowerShell въведете `Install-Module -Name Az.Accounts` и следвайте стъпките.
   1. Повторете за `Install-Module -Name Az.Resources` и `Install-Module -Name Az.Storage`.

### <a name="execute-powershell-scripts-and-obtain-the-permission-identifier"></a>Изпълнение на powerShell скриптове и получаване на идентификатор на разрешение

1. Изтеглете двата скрипта powerShell, които трябва да изпълните от gitHub репото [на](https://github.com/trin-msft/byol) нашия инженер.
   - `CreateSecurityGroups.ps1`: Изисква разрешения за администратор на наемателя.
   - `ByolSetup.ps1`: Изисква Съхранение Blob Data Owner разрешения на ниво акаунт за съхранение/контейнер. Този скрипт ще създаде разрешението за вас. Задачата ви за роля може да бъде премахната ръчно след успешно изпълнение на скрипта.

1. Изпълни `CreateSecurityGroups.ps1` в Windows PowerShell, като предоставиш ИД на абонамент за Azure, съдържащ твоя Azure Data Lake Storage. Отворете скрипта PowerShell в редактор, за да прегледате допълнителна информация и внедрената логика.

   Този скрипт създава две групи за защита на вашия абонамент за Azure: една за групата читатели и друга за групата "Сътрудник". Microsoft Dataverse услуга е собственик както за тези групи за сигурност.

1. Запишете и двете стойности на ИД на група за защита, генерирани от този скрипт, да се използват в скрипта `ByolSetup.ps1`.

   > [!NOTE]
   > Създаването на група за защита може да бъде деактивирано на вашия наемател. В такъв случай би била необходима ръчна настройка и администраторът ви Azure AD ще трябва да даде възможност за [създаване на](/azure/active-directory/enterprise-users/groups-self-service-management) група за защита.

1. Изпълнявайте `ByolSetup.ps1` в Windows PowerShell, като предоставите ИД на абонамент за Azure, съдържащ вашето Azure Data Lake Storage, име на акаунт за съхранение, име на група ресурси и стойностите на ИД на групата за защита на четец и сътрудник. Отворете скрипта PowerShell в редактор, за да прегледате допълнителна информация и внедрената логика.

   Този скрипт добавя необходимия ролево базиран контрол на достъпа за Microsoft Dataverse услугата и всякакви Dataverse базирани бизнес приложения. Той също така актуализира списъка за контрол на достъпа (ACL) на `customerinsights` контейнера за групите за защита, създадени със скрипта `CreateSecurityGroups.ps1`. На групата "Сътрудник" се дава *разрешение от RWX* и на Readers group се дава *разрешение само r-x*.

1. Копирайте изходния низ, който изглежда като: `https://DVBYODLDemo/customerinsights?rg=285f5727-a2ae-4afd-9549-64343a0gbabc&cg=720d2dae-4ac8-59f8-9e96-2fa675dbdabc`

1. Въведете копирания изходен низ в **полето Идентификатор на разрешения** на стъпката за конфигуриране на средата за Microsoft Dataverse.

   :::image type="content" source="media/dataverse-enable-datasharing-BYODL.png" alt-text="Опции за конфигуриране, за да разрешите споделянето на данни от вашите собствени Azure Data Lake Storage с Microsoft Dataverse.":::

## <a name="remove-an-existing-connection-to-a-dataverse-environment"></a>Премахване на съществуваща връзка към Dataverse среда

Когато се свързвате към Dataverse среда, съобщението **за грешка Тази CDS организация вече е прикрепена към друг екземпляр** на Customer Insights означава, че Dataverse средата вече се използва в среда на Customer Insights. Можете да премахнете съществуващата връзка като глобален администратор в Dataverse средата. Може да отнеме няколко часа, за да се населят промените.

1. Отидете на [Power Apps](https://make.powerapps.com).
1. Изберете средата от програмата за избор на среда.
1. Отидете на **Решения**.
1. Деинсталирайте или изтрийте решението с име **Dynamics 365 Customer Insights Добавка за карта на клиент (Визуализация)**.

ИЛИ

1. Отворете средата си Dataverse.
1. Отидете на **Решения** > **за** разширени настройки.
1. Деинсталирайте **решението CustomerInsightsCustomerCard**.

Ако премахването на връзката е неуспешно поради зависимости, трябва да премахнете зависимостите също. За повече информация вижте [Премахване на зависимости](/power-platform/alm/removing-dependencies).

## <a name="output-entities"></a>Изходни обекти

Някои изходни обекти от "Аналитични данни за клиенти" се предлагат като таблици в Dataverse. Разделите по-долу описват очакваната схема на тези таблици.

- [CustomerProfile](#customerprofile)
- [КонтактПрофил](#contactprofile)
- [AlternateKey](#alternatekey)
- [UnifiedActivity](#unifiedactivity)
- [CustomerMeasure](#customermeasure)
- [Обогатяване](#enrichment)
- [Прогноза](#prediction)
- [Членство в сегмент](#segment-membership)

### <a name="customerprofile"></a>CustomerProfile

Тази таблица съдържа единния потребителски профил от Customer Insights. Схемата за унифициран профил на клиент зависи от обектите и атрибутите, използвани в процеса на обединяване на данни. Схемата на потребителския профил обикновено съдържа подмножество на атрибутите от [Дефиниция на Common Data Model на CustomerProfile](/common-data-model/schema/core/applicationcommon/foundationcommon/crmcommon/solutions/customerinsights/customerprofile). За сценария B-към-B профилът на клиента съдържа единни акаунти и схемата обикновено съдържа подмножество на атрибутите от [общата дефиниция на акаунт](/common-data-model/schema/core/applicationcommon/foundationcommon/crmcommon/account) за модел на данни.

### <a name="contactprofile"></a>КонтактПрофил

Профил на контакт съдържа единна информация за контакт. Контактите са [физически лица, които са съпоставени с акаунт](data-unification-contacts.md) в b-to-B сценарий.

| Column                       | Тип                | Описание     |
| ---------------------------- | ------------------- | --------------- |
|  Раждане            | ДатаЧас       |  Дата на раждане на контакта               |
|  Град                 | Текстово съобщение |  Град на адреса за контакт               |
|  КонтактИд            | Текстово съобщение |  ИД на профила на контакта               |
|  КонтактПрофилИд     | Еднозначен идентификатор   |  GUID за контакта               |
|  ДържаваРегион      | Текстово съобщение |  Държава/Регион на адреса за контакт               |
|  CustomerId           | Текстово съобщение |  ИД на акаунта контактът е нанесен на               |
|  EntityName           | Текстово съобщение |  Обект, от който идват данни                |
|  FirstName            | Текстово съобщение |  собствено име на контакта               |
|  Пол               | Текстово съобщение |  Пол на контакта               |
|  ИД                   | Текстово съобщение |  Детерминистичен GUID въз основа на`Identifier`               |
|  Идентификатор           | Текстово съобщение |  Вътрешен ИД на профила на контакта: `ContactProfile|CustomerId|ContactId`               |
|  JobTitle             | Текстово съобщение |  Длъжност на контакта               |
|  LastName             | Текстово съобщение |  фамилно име на контакта               |
|  PostalCode           | Текстово съобщение |  Пощенски код на адреса за контакт               |
|  ПървиченЕмайл         | Текстово съобщение |  Имейл адрес на контакта               |
|  Първичен Телефон         | Текстово съобщение |  Телефонен номер на контакта               |
|  StateOrProvince      | Текстово съобщение |  Държава или провинция на адреса за контакт               |
|  УлицаДрес        | Текстово съобщение |  Улица на адреса за контакт               |

### <a name="alternatekey"></a>AlternateKey

Таблицата AlternateKey съдържа ключове на обектите, участвали в процеса на обединяване.

|Column  |Тип  |Описание  |
|---------|---------|---------|
|DataSourceName    |Текстово съобщение         | Име на източник на данни. Например: `datasource5`        |
|EntityName        | Текстово съобщение        | Име на обекта в "Аналитични данни за клиенти". Например: `contact1`        |
|AlternateValue    |Текстово съобщение         |Алтернативен идентификатор, който се съпоставя с идентификатора на клиента. Пример: `cntid_1078`         |
|KeyRing           | Текстово съобщение        | Стойност на JSON  </br> Пример: [{"dataSourceName":" datasource5 ",</br>"entityName":" contact1",</br>"preferredKey":" cntid_1078",</br>"keys":[" cntid_1078"]}]       |
|CustomerId         | Текстово съобщение        | Идентификационен номер на унифицирания потребителски профил.         |
|AlternateKeyId     | Еднозначен идентификатор        |  АлтернативенКлючовият детерминистичен GUID въз основа на`Identifier`      |
|Идентификатор |   Текстово съобщение      |   `DataSourceName|EntityName|AlternateValue`  </br> Пример: `testdatasource|contact1|cntid_1078`    |

### <a name="unifiedactivity"></a>UnifiedActivity

Тази таблица съдържа дейности от потребители, които са налични в Customer Insights.

| Column            | Тип        | Описание                                                                              |
|-------------------|-------------|------------------------------------------------------------------------------------------|
| CustomerId        | Текстово съобщение      | ИД на профил на клиент                                                                      |
| ActivityId        | Текстово съобщение      | Вътрешен идентификатор на активността на клиента (първичен ключ)                                       |
| SourceEntityName  | Текстово съобщение      | Име на обекта-източник                                                                |
| SourceActivityId  | Текстово съобщение      | Първичен ключ от изходния обект                                                       |
| ActivityType      | Текстово съобщение      | Тип семантична дейност или име на персонализирана дейност                                        |
| ActivityTimeStamp | ДатаЧас    | Печат за време за активност                                                                      |
| Обръщение             | Текстово съобщение      | Заглавие или име на дейността                                                               |
| Описание       | Текстово съобщение      | Описание на дейността                                                                     |
| URL адрес               | Текстово съобщение      | Връзка към външен URL адрес, специфичен за дейността                                         |
| SemanticData      | Текстово съобщение | Включва списък на двойки ключови стойности за семантични полета за картографиране, специфични за вида дейност |
| RangeIndex        | Текстово съобщение      | Отпечатъкът на Unix, използван за сортиране на времевата линия на дейността и ефективни заявки за диапазон |
| ЕдиннаАктивностId   | Еднозначен идентификатор | Вътрешен идентификатор на активността на клиента (ActivityId) |

### <a name="customermeasure"></a>CustomerMeasure

Тази таблица съдържа изходни данни за базирани на атрибути на клиента мерки.

| Column             | Тип             | Описание                 |
|--------------------|------------------|-----------------------------|
| CustomerId         | Текстово съобщение           | ИД на профил на клиент        |
| Мерки           | Текстово съобщение      | Включва списък с двойки ключови стойности за име на мярка и стойности за дадения клиент |
| Идентификатор | Текстово съобщение           | `Customer_Measure|CustomerId` |
| CustomerMeasureId | Еднозначен идентификатор     | ИД на профил на клиент |

### <a name="enrichment"></a>Допълване

Тази таблица съдържа резултатите от процеса на обогатяване.

| Column               | Тип             |  Описание                                          |
|----------------------|------------------|------------------------------------------------------|
| CustomerId           | Текстово съобщение           | ИД на профил на клиент                                 |
| EnrichmentProvider   | Текстово съобщение           | Имена доставчика за допълването                                  |
| EnrichmentType       | Текстово съобщение           | Тип на обогатяване                                      |
| Стойности               | Текстово съобщение      | Списък на атрибутите, получени в процеса на обогатяване |
| ОбогатяванеId | Еднозначен идентификатор            | Детерминистичен GUID, генериран от`Identifier` |
| Идентификатор   | Текстово съобщение           | `EnrichmentProvider|EnrichmentType|CustomerId`         |

### <a name="prediction"></a>Прогноза

Тази таблица съдържа резултатите на предсказанията на модела.

| Column               | Тип        | Описание                                          |
|----------------------|-------------|------------------------------------------------------|
| CustomerId           | Текстово съобщение      | ИД на профил на клиент                                  |
| ModelProvider        | Текстово съобщение      | Имена доставчика на модела                                      |
| Модел                | Текстово съобщение      | Име на модела                                                |
| Стойности               | Текстово съобщение | Списък на атрибутите, получени от модела |
| ПрогнозиранеId | Еднозначен идентификатор       | Детерминистичен GUID, генериран от`Identifier` |
| Идентификатор   | Текстово съобщение      |  `Model|ModelProvider|CustomerId`                      |

### <a name="segment-membership"></a>Членство в сегмент

Тази таблица съдържа информация за членство в сегмент на профилите на клиента.

| Column        | Тип | Описание                        |
|--------------------|--------------|-----------------------------|
| CustomerId        | Текстово съобщение       | ИД на профил на клиент        |
| СегментПрочетир      | Текстово съобщение       | Приложение, което публикува сегментите.      |
| СегментМембърствоТип | Текстово съобщение       | Тип клиент за този запис на членство в сегмент. Поддържа няколко типа като "Клиент", "Контакт" или "Акаунт". По подразбиране: Клиент  |
| Сегменти       | Текстово съобщение  | Списък с уникални сегменти профилът на клиента е член на      |
| Идентификатор  | Текстово съобщение   | Еднозначен идентификатор на записа за членство в сегмент. `CustomerId|SegmentProvider|SegmentMembershipType|Name`  |
| СегментМембърбордId | Еднозначен идентификатор      | Детерминистичен GUID, генериран от`Identifier`          |

[!INCLUDE [footer-include](includes/footer-banner.md)]
