---
title: Свържете с папка на Common Data Model с помощта на акаунт в Azure Data Lake
description: Работа с данни от Common Data Model с помощта на Azure Data Lake Storage.
ms.date: 09/29/2022
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
ms.reviewer: v-wendysmith
manager: shellyha
searchScope:
- ci-data-sources
- ci-create-data-source
- ci-attach-cdm
- customerInsights
ms.openlocfilehash: c12603b9ed8a814356a0f8d0137e97afc749b87c
ms.sourcegitcommit: be341cb69329e507f527409ac4636c18742777d2
ms.translationtype: MT
ms.contentlocale: bg-BG
ms.lasthandoff: 09/30/2022
ms.locfileid: "9609929"
---
# <a name="connect-to-data-in-azure-data-lake-storage"></a>Свързване към данни в Azure Data Lake Storage

Поглъщайте данни в Dynamics 365 Customer Insights използването на вашия Azure Data Lake Storage Gen2 акаунт. Поглъщането на данни може да бъде пълно или постепенно.

## <a name="prerequisites"></a>Предварителни изисквания

- Поглъщането на данни поддържа Azure Data Lake Storage *изключително акаунти* в Gen2. Не можете да използвате акаунтите на Data Lake Storage Gen1, за да поглъщате данни.

- Акаунтът Azure Data Lake Storage трябва да има [йерархично пространство за имена](/azure/storage/blobs/data-lake-storage-namespace). Данните трябва да се съхраняват във йерархичен формат на папката, който определя основната папка и има подпапки за всяко предприятие. Подпапките могат да имат пълни данни или допълнителни папки с данни.

- За да се удостоверите с принципал на услуга на Azure, уверете се, че е конфигуриран във вашия клиент. За повече информация вижте [Свързване към акаунт в Azure Data Lake Storage Gen2 с директор](connect-service-principal.md) на услугата Azure.

- Данните Azure Data Lake Storage, от които искате да се свържете и поглъщате, трябва да бъдат в същия регион на Azure като Dynamics 365 Customer Insights околната среда. Не се поддържат връзки към папка на Common Data Model от хранилището с данни в различен регион на Azure. За да знаете региона на Azure на околната среда, отидете **на Admin** > **System** > **За** в Клиентски прозрения.

- Данните, съхранявани в онлайн услугите, могат да се съхраняват на различно място, отколкото когато данните се обработват или съхраняват в Dynamics 365 Customer Insights тях.Чрез импортиране или свързване към данни, съхранявани в онлайн услуги, Вие се съгласявате, че данните могат да бъдат прехвърляни и съхранявани с Dynamics 365 Customer Insights. [Научете повече в Доверителния център на Microsoft](https://www.microsoft.com/trust-center).

- Директорът на услугата Customer Insights трябва да бъде в една от следните роли за достъп до акаунта за съхранение. За повече информация вижте [разрешенията за безвъзмездна помощ на директора на услугата за достъп до акаунта](connect-service-principal.md#grant-permissions-to-the-service-principal-to-access-the-storage-account) за съхранение.
  - Четец на данни за съхранение в Blob
  - Собственик на данни за съхранение в Blob
  - Сътрудник за данни за BLOB за съхранение

- Потребителят, който настройва източник на данни връзка, се нуждае от най-малко разрешения за съхранение на данни на Blob Data Contributor в акаунта за съхранение.

- Данните във Вашето хранилище на Data Lake трябва да следват стандарта Common Data Model за съхранение на Вашите данни и да имат общ модел на данни, който да представлява схемата на файловете с данни (*.csv или *.parquet). Манифестът трябва да предоставя подробности за субектите, като колони на предприятието и типове данни, както и местоположението на файла с данни и типа файл. За повече информация вижте манифеста [на](/common-data-model/sdk/manifest) Общия модел на данни. Ако манифестът не е налице, потребителите на администратори със собственик на данни за съхранение Blob или достъп до сътрудник за съхранение на данни на Blob могат да определят схемата при поглъщане на данните.

## <a name="recommendations"></a>Препоръки

За оптимална производителност Customer Insights препоръчва размерът на дяла да бъде 1 GB или по-малко, а броят на дяловите файлове в папка не трябва да надвишава 1000.

## <a name="connect-to-azure-data-lake-storage"></a>Свързване с Azure Data Lake Storage

1. Отидете на **Данни** > **Източници на данни**.

1. Изберете **Добавяне на източник на данни**.

1. Изберете **Azure данни езеро съхранение**.

   :::image type="content" source="media/data_sources_ADLS.png" alt-text="Диалогов прозорец, за да въведете подробности за връзката за езерото Azure Data Lake." lightbox="media/data_sources_ADLS.png":::

1. Въведете **име** за източник на данни и незадължително **описание**. Името уникално идентифицира източник на данни и се споменава в процесите надолу по веригата и не може да бъде променено.

1. Изберете една от следните опции за **свързване на вашето хранилище,** като използвате. За повече информация вижте [Свързване на клиентски прозрения към акаунт в Azure Data Lake Storage Gen2 с директор](connect-service-principal.md) на услугата Azure.

   - **Azure ресурс**: Въведете идентификатора **на ресурса**. По желание, ако искате да поглъщате данни от акаунт за съхранение чрез частна връзка на Azure, изберете **Активиране на частна връзка**. За повече информация вижте [Частни връзки](security-overview.md#set-up-an-azure-private-link).
   - **Абонамент за Azure: Изберете Абонамента и след това Ресурсната група** и **акаунта за** **съхранение**.**·** По желание, ако искате да поглъщате данни от акаунт за съхранение чрез частна връзка на Azure, изберете **Активиране на частна връзка**. За повече информация вижте [Частни връзки](security-overview.md#set-up-an-azure-private-link).
  
   > [!NOTE]
   > Имате нужда от една от следните роли или в контейнера, или в акаунта за съхранение, за да създадете източник на данни:
   >
   >  - Storage Blob Data Reader е достатъчен, за да се чете от акаунт за съхранение и да се поглъщат данните към Клиентски прозрения.
   >  - Съхранение Blob Data Contributor или собственик е необходимо, ако искате да редактирате манифестните файлове директно в Клиентски прозрения.  
  
1. Изберете името на **контейнера**, който съдържа данните и схемата (model.json или manifest.json файл), за да импортирате данни от, и изберете **Напред**.
   > [!NOTE]
   > Всеки файл model.json или manifest.json, свързан с друг източник на данни в средата, няма да се показва в списъка. Същият файл model.json или manifest.json обаче може да се използва за източници на данни в множество среди.

1. За да създадете нова схема, отидете на Създаване на [нов файл с](#create-a-new-schema-file) схема.

1. За да използвате съществуваща схема, навигирайте до папката, съдържаща файла model.json или manifest.cdm.json. Можете да търсите в директория, за да намерите файла.

1. Изберете файла json и изберете **Напред**. Списък на наличните единици показва.

   :::image type="content" source="media/review-entities.png" alt-text="Диалогов прозорец на списък с единици, които да изберете":::

1. Изберете субектите, които искате да включите.

   :::image type="content" source="media/ADLS_required.png" alt-text="Диалогов прозорец, показващ Необходим за първичен ключ":::

   > [!TIP]
   > За да редактирате предприятие в интерфейс за редактиране на JSON, изберете предприятието и след това **редактирайте файла на схемата**. Направете промени и изберете **Save**.

1. За избрани субекти, които изискват постепенно поглъщане, **Необходими** дисплеи под **Постепенно опресняване**. За всеки от тези субекти вижте [Конфигуриране на постепенно опресняване за източниците](incremental-refresh-data-sources.md) на данни на Azure Data Lake.

1. За избрани субекти, където първичен ключ не е дефиниран, **Необходими** дисплеи под **първичен ключ**. За всеки от тези субекти:
   1. Изберете **задължително**. Дисплеи на панела за редактиране на **същността**.
   1. Изберете **основния ключ**. Основният ключ е атрибут, уникален за предприятието. За да бъде атрибутът валиден първичен ключ, той не трябва да включва дублирани стойности, липсващи стойности или нулеви стойности. Атрибутите на низ, цяло число и GUID тип данни се поддържат като основни ключове.
   1. По желание променете модела на дяла.
   1. Изберете **Близо**, за да запишете и затворите панела.

1. Изберете броя на **атрибутите** за всяко включено предприятие. Страницата за управление на **атрибутите** показва.

   :::image type="content" source="media/dataprofiling-entities.png" alt-text="Диалогов прозорец, за да изберете профилиране на данни.":::

   1. Създаване на нови атрибути, редактиране или изтриване на съществуващи атрибути. Можете да промените името, формата на данните или да добавите семантичен тип.
   1. За да активирате анализи и други възможности, изберете **профилиране** на данни за цялото предприятие или за конкретни атрибути. По подразбиране не е разрешен обект за профилиране на данни.
   1. Изберете **Готово**.

1. Изберете **Записване**. Страницата **с източници** на данни се отваря, показвайки новия източник на данни в **освежаващо** състояние.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

Зареждането на данни може да отнеме време. След успешно обновяване, погълнатите данни могат да бъдат прегледани от страницата на Същностите [**·**](entities.md).

### <a name="create-a-new-schema-file"></a>Създаване на нов файл за схеми

1. Изберете **нов акаунт в схемата**.

1. Въведете име за файла и изберете **Save**.

1. Изберете **нов субект**. Показва се панелът на **новия субект**.

1. Въведете името на предприятието и изберете местоположението **на файловете с** данни.
   - **Множество .csv или .parquet файлове**: Преглед на основната папка, изберете типа модел и въведете израза.
   - **Единични .csv или .parquet файлове**: Преглед на файла .csv или .parquet и го изберете.

   :::image type="content" source="media/ADLS_new_entity_location.png" alt-text="Диалогов прозорец, за да създадете нова същност с подчертано местоположение на файлове с данни.":::

1. Изберете **Записване**.

   :::image type="content" source="media/ADLS_new_entity_define_attributes.png" alt-text="Диалогов прозорец за дефиниране или автоматично генериране на атрибути.":::

1. Изберете **дефиниране на атрибутите, за да добавите ръчно атрибутите**, или изберете **автоматично да ги генерирате**. За да дефинирате атрибутите, въведете име, изберете формата на данните и незадължителния семантичен тип. За автоматично генерирани атрибути:

   1. След като атрибутите са автоматично генерирани, изберете **атрибути за** преглед. Страницата за управление на **атрибутите** показва.

   1. Уверете се, че форматът на данните е правилен за всеки атрибут.

   1. За да активирате анализи и други възможности, изберете **профилиране** на данни за цялото предприятие или за конкретни атрибути. По подразбиране не е разрешен обект за профилиране на данни.

      :::image type="content" source="media/dataprofiling-entities.png" alt-text="Диалогов прозорец, за да изберете профилиране на данни.":::

   1. Изберете **Готово**. Показва се страницата " **Избор на субекти** ".

1. Продължете да добавяте субекти и атрибути, ако е приложимо.

1. След като всички предприятия са добавени, изберете **Включи** да включи субектите в източник на данни поглъщане.

   :::image type="content" source="media/ADLS_required.png" alt-text="Диалогов прозорец, показващ Необходим за първичен ключ":::

1. За избрани субекти, които изискват постепенно поглъщане, **Необходими** дисплеи под **Постепенно опресняване**. За всеки от тези субекти вижте [Конфигуриране на постепенно опресняване за източниците](incremental-refresh-data-sources.md) на данни на Azure Data Lake.

1. За избрани субекти, където първичен ключ не е дефиниран, **Необходими** дисплеи под **първичен ключ**. За всеки от тези субекти:
   1. Изберете **задължително**. Дисплеи на панела за редактиране на **същността**.
   1. Изберете **основния ключ**. Основният ключ е атрибут, уникален за предприятието. За да бъде атрибутът валиден първичен ключ, той не трябва да включва дублирани стойности, липсващи стойности или нулеви стойности. Атрибутите на низ, цяло число и GUID тип данни се поддържат като основни ключове.
   1. По желание променете модела на дяла.
   1. Изберете **Близо**, за да запишете и затворите панела.

1. Изберете **Записване**. Страницата **с източници** на данни се отваря, показвайки новия източник на данни в **освежаващо** състояние.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

Зареждането на данни може да отнеме време. След успешно обновяване, погълнатите данни могат да бъдат прегледани от страницата на Същностите [**·**](entities.md).

## <a name="edit-an-azure-data-lake-storage-data-source"></a>Редактиране на Azure Data Lake Storage източник на данни

Можете да актуализирате акаунта за свързване към акаунта *за съхранение, като използвате* опция. За повече информация вижте [Свързване на клиентски прозрения към акаунт в Azure Data Lake Storage Gen2 с директор](connect-service-principal.md) на услугата Azure. За да се свържете с различен контейнер от акаунта за съхранение или да промените името на акаунта, трябва [да създадете нова връзка с източник на данни](#connect-to-azure-data-lake-storage).

1. Отидете на **Данни** > **Източници на данни**.

1. До източник на данни, които искате да актуализирате, изберете **Редактиране**.

   :::image type="content" source="media/data_sources_edit_ADLS.png" alt-text="Диалогов прозорец за редактиране на Azure Data Lake източник на данни.":::

1. Променете някоя от следните данни:

   - **Описание**
   - **Свържете съхранението си с помощта** и информацията за връзката. Не можете да се промените информацията **Контейнер** при актуализиране на връзката.
      > [!NOTE]
      > Една от следните роли трябва да бъде възложена на сметката за съхранение или контейнера:
        > - Четец на данни за съхранение в Blob
        > - Собственик на данни за съхранение в Blob
        > - Сътрудник за данни за BLOB за съхранение

   - **Активирайте Private Link, ако искате да поглъщате данни от акаунт за съхранение чрез Azure Private Link**. За повече информация вижте [Частни връзки](security-overview.md#set-up-an-azure-private-link).

1. Изберете **Напред**.
1. Променете някое от следните:
   - Навигирайте до друг model.json или manifest.json файл с различен набор от същности от контейнера.
   - За да добавите допълнителни субекти към поглъщането, изберете **Ново предприятие**.
   - За да премахнете вече избрани субекти, ако няма зависимости, изберете предприятието и **изтрийте**.
      > [!IMPORTANT]
      > Ако има зависимости от съществуващия файл model.json или manifest.json и набора от обекти, ще видите съобщение за грешка и не можете да изберете различен файл model.json или manifest.json. Премахнете тези зависимости, преди да промените файла model.json или manifest.json или създайте нов източник на данни с файла model.json или manifest.json, който искате да използвате, за да избегнете премахването на зависимостите.
   - За да промените местоположението на файла с данни или основния ключ, изберете **Редактиране**.
   - За да промените данните за постепенно поглъщане, вижте [Конфигуриране на постепенно обновяване за източниците](incremental-refresh-data-sources.md) на данни на Azure Data Lake.
   - Променете само името на предприятието, за да съответства на името на предприятието във файла .json.

     > [!NOTE]
     > Винаги дръжте името на предприятието в Customer Insights същото като името на предприятието вътре в файла model.json или manifest.json след поглъщане. Customer Insights валидира всички имена на същности с model.json или manifest.json по време на всяко обновяване на системата. Ако името на предприятието е променено или вътре в Customer Insights, или извън него, възниква грешка, защото Customer Insights не може да намери новото име на предприятието във файла .json. Ако случайно е променено име на погълнат субект, редактирайте името на предприятието в Customer Insights, за да съответства на името във файла .json.

1. Изберете **атрибути**, за да добавите или промените атрибутите или да разрешите профилирането на данни. След това изберете **Готово**.

1. Щракнете върху Запиши **, за да приложите** промените си и да се върнете към страницата с източници **на** данни.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

## <a name="common-reasons-for-ingestion-errors-or-corrupt-data"></a>Общи причини за грешки при поглъщане или повредени данни

По време на поглъщането на данни някои от най-честите причини, поради които записът може да се счита за корумпиран, включват:

- Типовете данни и стойностите на полетата не съвпадат между изходния файл и схемата
- Броят на колоните в изходния файл не съответства на схемата
- Полетата съдържат знаци, които карат колоните да се изкривяват в сравнение с очакваната схема. Например: неправилно форматирани цитати, неизбягали кавички, знаци от нов ред или табирани знаци.
- Липсват преградни файлове
- Ако има колони за дата/дата/дата, форматът им трябва да бъде посочен в схемата, ако не следва стандартния формат.

### <a name="schema-or-data-type-mismatch"></a>Схема или несъответствие на типа данни

Ако данните не съответстват на схемата, процесът на поглъщане завършва с грешки. Коригирайте или изходните данни, или схемата и повторно поглъщане на данните.

### <a name="partition-files-are-missing"></a>Липсват преградни файлове

- Ако поглъщането е било успешно без никакви корумпирани записи, но не можете да видите никакви данни, редактирайте вашия model.json или manifest.json файл, за да сте сигурни, че са посочени дялове. След това [освежете източник на данни](data-sources.md#refresh-data-sources).

- Ако поглъщането на данни се случи едновременно с обновяването на източниците на данни по време на автоматично обновяване на графика, дяловите файлове могат да бъдат празни или да не са достъпни за обработка на Customer Insights. За да се приведете в съответствие с графика за обновяване нагоре по веригата, променете графика за обновяване на [системата или графика](schedule-refresh.md) за опресняване за източник на данни. Подравнете времето, така че опресняването да не се случва наведнъж и да предостави най-новите данни, които да бъдат обработени в Customer Insights.

### <a name="datetime-fields-in-the-wrong-format"></a>Полета за дата в грешен формат

Полетата за дата в предприятието не са в ISO 8601 или en-US формати. Форматът по подразбиране за дата в Customer Insights е формат en-US. Всички полета за дата в предприятието трябва да бъдат в един и същ формат. Customer Insights поддържа други формати, при условие че анотации или черти са направени на ниво източник или субект в модела или manifest.json. Например:

**Модел.json**

   ```json
      "annotations": [
        {
          "name": "ci:CustomTimestampFormat",
          "value": "yyyy-MM-dd'T'HH:mm:ss:SSS"
        },
        {
          "name": "ci:CustomDateFormat",
          "value": "yyyy-MM-dd"
        }
      ]   
   ```

  В manifest.json форматът за дата може да бъде определен на ниво субект или на ниво атрибут. На ниво субект използвайте "експонатиЧерти" в предприятието в *.manifest.cdm.json, за да определите формата за дата. На ниво атрибут използвайте "приложеничерти" в атрибута в името на предприятието.cdm.json.

**Manifest.json на ниво субект**

```json
"exhibitsTraits": [
    {
        "traitReference": "is.formatted.dateTime",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd'T'HH:mm:ss"
            }
        ]
    },
    {
        "traitReference": "is.formatted.date",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd"
            }
        ]
    }
]
```

**Entity.json на ниво атрибут**

```json
   {
      "name": "PurchasedOn",
      "appliedTraits": [
        {
          "traitReference": "is.formatted.date",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-dd"
            }
          ]
        },
        {
          "traitReference": "is.formatted.dateTime",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-ddTHH:mm:ss"
            }
          ]
        }
      ],
      "attributeContext": "POSPurchases/attributeContext/POSPurchases/PurchasedOn",
      "dataFormat": "DateTime"
    }
```

[!INCLUDE [footer-include](includes/footer-banner.md)]
